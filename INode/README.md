# serverdensity-inode-plugin
[Server Density Plugin](https://plugins.serverdensity.com/developers/) - iNode usage plugin for serverdensity.com


### Documentation

You can find the agent setup and writing a plugin script docs at [Writing a plugin - Linux, Mac and FreeBSD](https://support.serverdensity.com/hc/en-us/articles/360001066703)


### Installation

All you need to do is copy the INode.py file to the plugin directory which is explained at the documentation and sd-agent will pick-up the plugin.
After sd-agent's next call to plugins, INode.py will be executed and the resulting data will be available at serverdensity.io/dashboards.
Here you need to navigate to your "Devices", click the device that you have installed the plugin and click the Plugins tab.
At the Plugins tab, the top left select box's default value is "All plugins" that lists the data from all plugins.
Just select the "Inode" entry to see the INode plugin's data which should be a json containing the "exception", "error" and all the Mount points as keys.

The numeric value for each mount point indicates the percentage of the inodes used at that mount point.
Hence the motivation behind this plugin is to monitor the percentage of inodes and notify via mail and sms in order to take action.

The exception key usually is null, if the script encounters any errors than the exception will hold that.

The error key usually is null, if the df command gets and returns any errors, that will be at here.

_sample json_
```json
    {
        "exception": null,
        "error": null,
        "/": 12,
        "/dev": 1,
        "/boot": 1,
        "/run": 1,
    }
```

Click the "Alerting" tab to add alerts, hit the "Alert config", select "INode" and "/" from the first select box. Chose the ">" from the second
select box and type the value of the percentage that you want to be notified, ex: "90.0" not like "90", here the number should have a ".0" otherwise will not work correctly.
Chose people to notify at least one. Also you may set before triggering and repeat values, but they are not mandatory, leave them disabled and the alert will be send immediately.


### Editing

Default timeout value for df command to complete its execution is 5 seconds,
In order to change this value, edit the INode.py file and change the line sets the timeout as 5

_INode.py_
```python
        # first parameter is the timeout seconds
        self.timeout = 5
```

Default command is "df -i", you may add other parameters to df command, like "df -iha"
In order to do that, edit the INode.py file and change the line sets the command as 'df -i'

_INode.py_
```python
        # second one is the command to be called
        self.command = 'df -i'
```

The "allOrPercentage" parameter that is set to True by default indicates if the script will return only the INode
usage percentage or all the data generated by df command. If you pland to get the whole output from df command,
simply change True to False.

_INode.py_
```python
        # this indicates if to return the all results or just the percentage
        self.allOrPercentage = True
```

This change will generate a json similar to below example, although this json delivers more information,
currently it is not usable at the serverdensity.io/dashboards's alerts, since the "Alerting" has only one level for json values,
you can find detailed information about setting alerts at "Installation" section.

_sample json_
```json
    {
        "exception": null,
        "error": null,
        "/": {
            "IUse%": "12%",
            "IUsed": "1.7M",
            "Mounted_on": "/",
            "Inodes": "14M",
            "Filesystem": "/dev/md2",
            "IFree": "13M"
        },
        "/boot": {
            "IUse%": "1%",
            "IUsed": "247",
            "Mounted_on": "/boot",
            "Inodes": "128K",
            "Filesystem": "/dev/md1",
            "IFree": "128K"
        },
        "/run": {
            "IUse%": "1%",
            "IUsed": "399",
            "Mounted_on": "/run",
            "Inodes": "4.0M",
            "Filesystem": "tmpfs",
            "IFree": "4.0M"
        }
    }
```

